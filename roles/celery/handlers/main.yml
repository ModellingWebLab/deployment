# Restart Celery when we've changed its configuration in any way

- name: reload systemd
  become: true
  systemd: daemon_reload=yes

- name: clean celery state
  become: true
  block:
    file:
      path: '{{ celery_state_dir }}'
      state: absent
    file:
      path: '{{ celery_state_dir }}'
      state: directory
      owner: '{{ celery_user }}'
      mode: 0755

- name: restart celery
  listen: restart experiment runner
  become: true
  service:
    name: '{{ celery_service_name }}'
    state: restarted
