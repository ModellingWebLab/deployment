# Set up the (WL1) functional curation experiment runner backend

- name: Install Chaste dependencies
  become: yes
  block:
    - name: Chaste | Add our apt key
      apt_key:
        id: 422C4D99
        keyserver: hkp://keyserver.ubuntu.com:80
        state: present
    - name: Chaste | Add our apt repo
      apt_repository:
        repo: deb http://www.cs.ox.ac.uk/chaste/ubuntu xenial/
        filename: chaste
        state: present
        update_cache: yes
    - name: Chaste | Install the dependencies packages
      apt:
        name: "{{ item }}"
        state: present
        install_recommends: yes
      with_items:
        - chaste-dependencies
        - python-dev
        - python-scipy
        - python-numpy
        - cython
        - python-tables
        - python-matplotlib
        - python-numexpr
      notify:
        - rebuild Chaste

- name: Install Chaste & FunctionalCuration
  become: yes
  become_user: '{{ fc_user }}'
  block:
    - name: Checkout Chaste
      git:
        clone: yes
        dest: '{{ chaste_root }}'
        repo: '{{ chaste_repo }}'
        version: develop
        update: yes
        force: yes
      notify:
        - rebuild Chaste

    - name: Checkout FunctionalCuration
      subversion:
        checkout: yes
        username: anonymous
        password: ansible@weblab.org
        dest: '{{ fc_root }}'
        repo: '{{ fc_repo }}'
        update: yes
        force: yes
      notify:
        - rebuild Chaste
