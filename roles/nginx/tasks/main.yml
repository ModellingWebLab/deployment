# Our specific tasks for configuring nginx
# Most is done by the imported geerlingguy.nginx role

- name: nginx | Copy SSL certificate
  copy:
    src: weblab.crt
    dest: "{{ ssl_certificate_folder }}"
    owner: root
    group: root
    mode: 0644
  notify:
    - reload nginx

- name: nginx | Copy SSL private key
  copy:
    src: weblab.key
    dest: "{{ ssl_key_folder }}"
    owner: root
    group: ssl-cert
    mode: 0640
  notify:
    - reload nginx

- name: nginx | Configure nginx
  import_role:
    name: geerlingguy.nginx

- name: nginx | Open https port
  ufw:
    name: Nginx Full
    rule: allow
    state: enabled
